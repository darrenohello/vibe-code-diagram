<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Vibe-coding Spectrum (Cursor)</title>
  <style>
    :root{
      --bg:#f8f7f4;
      --panel:#fff;
      --panel2:#f2f0eb;
      --ink:#1a1a1a;
      --muted:#505050;
      --faint:#787878;
      --line:#d4d2cc;
      --chip:#e8e6e1;
      --good:#2d6a4f;
      --warn:#9a6700;
      --bad:#b91c1c;
      --accent:#1a1a1a;
      --radius:6px;
      --shadow: 0 1px 2px rgba(0,0,0,.06);
      --shadow2: 0 1px 1px rgba(0,0,0,.04);
      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;
      --sans: "Segoe UI", system-ui, -apple-system, Roboto, Helvetica, Arial, sans-serif;
    }

    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:var(--sans);
      color:var(--ink);
      background: var(--bg);
    }

    a{color:inherit}
    .wrap{
      max-width: 1160px;
      margin: 0 auto;
      padding: 28px 18px 60px;
    }

    /* Header */
    header{
      display:flex;
      flex-wrap:wrap;
      align-items:flex-end;
      justify-content:space-between;
      gap:14px;
      margin-bottom:18px;
    }
    .title{
      display:flex;
      flex-direction:column;
      gap:8px;
      min-width: 260px;
    }
    h1{
      margin:0;
      font-size: clamp(26px, 2.6vw, 40px);
      letter-spacing:-0.02em;
      line-height:1.05;
    }
    .sub{
      margin:0;
      color:var(--muted);
      max-width: 72ch;
      font-size: 14.5px;
      line-height: 1.45;
    }
    .pillrow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:flex-end;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      gap:10px;
      border:1px solid var(--line);
      background: var(--panel);
      padding:10px 12px;
      border-radius: var(--radius);
    }
    .pill strong{
      font-size:12px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color:var(--muted);
      font-weight:700;
    }
    .toggle{
      display:inline-flex;
      border:1px solid var(--line);
      background: var(--panel2);
      padding:2px;
      border-radius: var(--radius);
      gap:0;
    }
    .toggle button{
      border:0;
      padding:6px 12px;
      border-radius: 4px;
      background: transparent;
      color: var(--muted);
      font-weight:500;
      font-size: 13px;
      cursor:pointer;
      transition: .12s ease;
    }
    .toggle button[aria-pressed="true"]{
      background: var(--panel);
      color: var(--ink);
      box-shadow: var(--shadow);
    }

    /* Layout */
    .grid{
      display:grid;
      grid-template-columns: 1fr;
      gap:14px;
    }
    @media (min-width: 980px){
      .grid{
        grid-template-columns: 0.95fr 1.35fr;
        align-items:start;
      }
    }

    /* Panels */
    .panel{
      border:1px solid var(--line);
      background: var(--panel);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .panel .hd{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:14px 16px 10px;
      border-bottom:1px solid var(--line);
    }
    .panel .hd h2{
      margin:0;
      font-size: 14px;
      letter-spacing:.06em;
      text-transform:uppercase;
      color: var(--muted);
    }
    .panel .bd{
      padding:16px;
    }

    /* Axes panel */
    .axes-summary{
      padding: 4px 0;
    }
    .axes-summary .chips-row{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      align-items:center;
      margin:10px 0 12px;
      font-size: 13px;
      color: var(--muted);
    }
    .axes-summary .chips-row span{ white-space:nowrap; }
    .axes-summary .brief{
      font-size: 13px;
      color: var(--muted);
      line-height: 1.5;
      margin: 0 0 14px;
    }
    .axes-toggle{
      display:inline-flex;
      align-items:center;
      gap:6px;
      border: 1px solid var(--line);
      background: var(--panel2);
      color: var(--ink);
      font-size: 13px;
      padding: 8px 12px;
      border-radius: var(--radius);
      cursor:pointer;
      font-family: inherit;
    }
    .axes-toggle:hover{ background: var(--chip); }
    .axisblock{
      display:flex;
      flex-direction:column;
      gap:14px;
    }
    .axes-panel.collapsed .axisblock,
    .axes-panel.collapsed .risk{ display:none; }
    .axes-panel:not(.collapsed) .axes-summary{ display:none; }
    .axis{
      border:1px solid var(--line);
      background: var(--panel2);
      border-radius: var(--radius);
      padding:12px;
    }
    .axis .row{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      margin-bottom:10px;
    }
    .axis .name{
      display:flex;
      flex-direction:column;
      gap:4px;
    }
    .axis .name b{
      font-size: 14px;
      letter-spacing:-.01em;
    }
    .axis .name span{
      font-size:12.5px;
      color: var(--muted);
      line-height:1.35;
    }
    .axis .scale{
      display:flex;
      align-items:center;
      gap:8px;
      color: var(--muted);
      font-size: 12px;
      font-family: var(--mono);
      white-space:nowrap;
    }
    .bar{
      position:relative;
      height:8px;
      border-radius: 4px;
      background: var(--line);
      overflow:visible;
    }
    .bar::after{
      content:"";
      position:absolute;
      inset:0;
      background: var(--chip);
      border-radius: 4px;
    }
    .marker{
      position:absolute;
      top:50%;
      transform: translate(-50%, -50%);
      width:12px;
      height:12px;
      border-radius: 2px;
      background: var(--ink);
      border: 1px solid var(--ink);
      z-index: 1;
    }
    .legend{
      display:flex;
      justify-content:space-between;
      font-size:12px;
      color: var(--muted);
      margin-top:8px;
    }

    /* Risk curve */
    .risk{
      margin-top: 4px;
      padding: 12px;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: var(--panel2);
    }
    .risk b{
      display:block;
      margin-bottom:6px;
      font-size: 13px;
      color: var(--ink);
    }
    .risk p{
      margin:0;
      font-size: 13px;
      color: var(--muted);
      line-height:1.45;
    }

    /* Spectrum panel */
    .spectrum{
      display:flex;
      flex-direction:column;
      gap:16px;
    }

    .rail{
      position:relative;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: var(--panel2);
      overflow:hidden;
    }
    .railhead{
      display:flex;
      justify-content:space-between;
      padding:12px 12px 0;
      color: var(--muted);
      font-size: 12px;
      font-family: var(--mono);
    }
    .cards{
      display:grid;
      grid-template-columns: 1fr;
      gap:10px;
      padding:12px;
    }
    @media (min-width: 780px){
      .cards{
        grid-template-columns: 1fr 1fr;
      }
    }
    @media (min-width: 1100px){
      .cards{
        grid-template-columns: 1fr 1fr 1fr;
      }
    }

    .card{
      position:relative;
      border:1px solid var(--line);
      background: var(--panel);
      border-radius: var(--radius);
      padding: 12px 12px 10px;
      transition: border-color .12s ease, background .12s ease;
      cursor:pointer;
      min-height: 168px;
      overflow:hidden;
    }
    .card:hover{
      border-color: var(--muted);
      background: var(--panel2);
    }
    .card[aria-selected="true"]{
      border-color: var(--ink);
      background: var(--panel2);
      box-shadow: inset 0 0 0 1px var(--ink);
    }
    .lvl{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:8px;
      margin-bottom: 8px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding: 4px 8px;
      border-radius: 4px;
      border:1px solid var(--line);
      background: var(--chip);
      font-size: 12px;
      color: var(--muted);
    }
    .tag .dot{
      width:6px;height:6px;border-radius:1px;background: var(--ink);
    }
    .tag.low .dot{ background: var(--good);}
    .tag.mid .dot{ background: var(--warn);}
    .tag.high .dot{ background: var(--bad);}

    .card h3{
      margin:0 0 6px;
      font-size: 15px;
      letter-spacing:-.01em;
    }
    .card p{
      margin:0 0 10px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.45;
    }
    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin-top:auto;
    }
    .chip{
      font-size: 12px;
      color: var(--muted);
      border: 1px solid var(--line);
      background: var(--chip);
      padding: 4px 8px;
      border-radius: 4px;
      white-space:nowrap;
    }

    /* Detail panel */
    .detail{
      border:1px solid var(--line);
      background: var(--panel2);
      border-radius: var(--radius);
      padding: 20px;
      margin-top: 20px;
    }
    .detail .top{
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:14px;
      margin-bottom:18px;
      padding-bottom:16px;
      border-bottom:1px solid var(--line);
    }
    .detail .top h3{
      margin:0;
      font-size: 17px;
      letter-spacing:-.02em;
    }
    .detail-oneliner{
      margin-top: 8px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
    }
    .detail .meta{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .meta .pill2{
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      border: 1px solid var(--line);
      background: var(--chip);
      padding: 4px 8px;
      border-radius: 4px;
    }
    .detail .cols{
      display:grid;
      grid-template-columns: 1fr;
      gap:16px;
    }
    @media (min-width: 980px){
      .detail .cols{
        grid-template-columns: 1fr 1fr;
        gap:20px;
      }
    }
    .box{
      border:1px solid var(--line);
      background: var(--panel);
      border-radius: var(--radius);
      padding: 16px;
    }
    .box b{
      display:block;
      font-size: 11px;
      letter-spacing:.08em;
      text-transform:uppercase;
      color: var(--muted);
      margin-bottom:10px;
    }
    .list{
      margin:0;
      padding-left: 20px;
      color: var(--ink);
    }
    .list li{
      margin: 8px 0;
      color: var(--muted);
      line-height: 1.5;
      font-size: 13px;
    }
    .list li:first-child{ margin-top: 0; }
    .list li:last-child{ margin-bottom: 0; }
    .detail-footer{
      margin-top: 16px;
      padding-top: 14px;
      border-top: 1px solid var(--line);
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      align-items: center;
    }

    /* Plot view */
    .plotwrap{
      display:none;
      gap:20px;
    }
    .plotwrap.active{ display:grid; }

    .plot{
      position:relative;
      border-radius: var(--radius);
      border:1px solid var(--line);
      background: var(--panel2);
      overflow:hidden;
      padding: 14px;
      min-height: 420px;
    }
    .plot .gridlines{
      position:absolute;
      inset: 0;
      background-image:
        linear-gradient(to right, var(--line) 1px, transparent 1px),
        linear-gradient(to bottom, var(--line) 1px, transparent 1px);
      background-size: 80px 80px;
      opacity: .6;
      pointer-events:none;
    }
    .plot .axes{
      position:absolute;
      inset: 0;
      pointer-events:none;
    }
    .plot .xlabel, .plot .ylabel{
      position:absolute;
      font-family: var(--mono);
      font-size: 12px;
      color: var(--muted);
      opacity: .95;
    }
    .plot .xlabel{ bottom: 10px; left: 14px; right: 14px; display:flex; justify-content:space-between; }
    .plot .ylabel{ top: 14px; left: 10px; height: calc(100% - 70px); display:flex; flex-direction:column; justify-content:space-between; }
    .plot .ylabel span{
      transform: translateY(-2px);
    }

    .node{
      position:absolute;
      transform: translate(-50%, -50%);
      width: 12px; height: 12px;
      border-radius: 2px;
      border: 1px solid rgba(0,0,0,.25);
      cursor:pointer;
    }
    .node::after{
      content: attr(data-label);
      position:absolute;
      top: -34px;
      left: 50%;
      transform: translateX(-50%);
      white-space:nowrap;
      background: var(--panel);
      border:1px solid var(--line);
      padding: 4px 8px;
      border-radius: 4px;
      color: var(--muted);
      font-size: 12px;
      font-family: var(--mono);
      opacity: 0;
      pointer-events:none;
      transition: .12s ease;
      box-shadow: var(--shadow);
    }
    .node:hover::after{ opacity: 1; }
    .node.sel{ box-shadow: 0 0 0 2px var(--ink); }

    .footerhint{
      margin-top: 10px;
      color: var(--muted);
      font-size: 12.5px;
      line-height: 1.45;
    }
    .kbd{
      font-family: var(--mono);
      font-size: 12px;
      padding: 2px 6px;
      border-radius: 4px;
      border:1px solid var(--line);
      background: var(--chip);
      color: var(--ink);
    }

    /* Version switcher (evolution of artefact) */
    .version-switcher{
      position: fixed;
      right: 16px;
      bottom: 16px;
      display: flex;
      align-items: center;
      gap: 6px;
      padding: 8px 14px;
      border-radius: 999px;
      background: color-mix(in srgb, var(--panel) 82%, transparent);
      border: 1px solid var(--line);
      opacity: 0.6;
      transition: opacity 0.25s ease;
      z-index: 10;
    }
    .version-switcher:hover{
      opacity: 1;
    }
    .version-switcher a{
      display: flex;
      align-items: center;
      justify-content: center;
      width: 36px;
      height: 36px;
      border-radius: 50%;
      border: 1px solid var(--line);
      background: var(--panel);
      color: var(--muted);
      font-size: 11px;
      font-weight: 600;
      font-family: var(--mono);
      text-decoration: none;
      transition: border-color .15s ease, background .15s ease, color .15s ease;
    }
    .version-switcher a:hover{
      border-color: var(--muted);
      background: var(--chip);
      color: var(--ink);
    }
    .version-switcher a.active{
      border-color: var(--ink);
      background: var(--ink);
      color: var(--panel);
    }
    .version-switcher a.active:hover{
      border-color: var(--ink);
      background: var(--ink);
      color: var(--panel);
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="title">
        <h1>Vibe-coding spectrum</h1>
        <p class="sub">
          A practical map of what Cursor can be used for — from low-consequence thinking artefacts
          to production work and organisational leverage.
        </p>
      </div>

      <div class="pillrow">
        <div class="pill">
          <strong>View</strong>
          <div class="toggle" role="group" aria-label="View toggle">
            <button id="btnRail" aria-pressed="true">Spectrum</button>
            <button id="btnPlot" aria-pressed="false">2D map</button>
          </div>
        </div>
        <div class="pill">
          <strong>Keyboard</strong>
          <div style="display:flex;gap:8px;align-items:center;color:var(--muted);font-family:var(--mono);font-size:12px">
            <span class="kbd">←</span><span class="kbd">→</span><span>select</span>
          </div>
        </div>
      </div>
    </header>

    <nav class="version-switcher" aria-label="Artefact version">
      <a href="index.html" class="version-link" title="Current version">v4</a>
      <a href="v3.html" class="version-link" title="Previous version">v3</a>
      <a href="v2.html" class="version-link active" title="This version">v2</a>
      <a href="v1.html" class="version-link" title="Earliest version">v1</a>
    </nav>

    <div class="grid">
      <!-- Left: Axes + risk -->
      <section class="panel" aria-label="Axes">
        <div class="hd">
          <h2>Four axes (what changes as you move right)</h2>
        </div>
        <div class="bd">
          <div class="axisblock">
            <div class="axis" data-axis="purpose">
              <div class="row">
                <div class="name">
                  <b>Purpose</b>
                  <span>Why you’re building: thinking → feeling → testing → shipping → leverage</span>
                </div>
                <div class="scale"><span>LOW</span><span>→</span><span>HIGH</span></div>
              </div>
              <div class="bar"><div class="marker" id="mPurpose" style="left:12%"></div></div>
              <div class="legend"><span>Idea shaping</span><span>Org impact</span></div>
            </div>

            <div class="axis" data-axis="integration">
              <div class="row">
                <div class="name">
                  <b>Integration depth</b>
                  <span>How connected it is to real systems and the team’s codebase</span>
                </div>
                <div class="scale"><span>ISOLATED</span><span>→</span><span>INTEGRATED</span></div>
              </div>
              <div class="bar"><div class="marker" id="mIntegration" style="left:10%"></div></div>
              <div class="legend"><span>Standalone</span><span>In-product</span></div>
            </div>

            <div class="axis" data-axis="fidelity">
              <div class="row">
                <div class="name">
                  <b>Fidelity</b>
                  <span>How “real” it feels and behaves (UX + functional realism)</span>
                </div>
                <div class="scale"><span>LOOSE</span><span>→</span><span>REAL</span></div>
              </div>
              <div class="bar"><div class="marker" id="mFidelity" style="left:18%"></div></div>
              <div class="legend"><span>Sketchy</span><span>Production-like</span></div>
            </div>

            <div class="axis" data-axis="consequence">
              <div class="row">
                <div class="name">
                  <b>Consequence</b>
                  <span>What breaks if it’s wrong: disposable → durable, low risk → high stakes</span>
                </div>
                <div class="scale"><span>LOW</span><span>→</span><span>HIGH</span></div>
              </div>
              <div class="bar"><div class="marker" id="mConsequence" style="left:14%"></div></div>
              <div class="legend"><span>Safe to be messy</span><span>Needs rigor</span></div>
            </div>

            <div class="risk" id="riskBox">
              <b>The risk curve</b>
              <p>
                As you move right: creative freedom drops, rigor increases, docs/ownership become real.
                The common failure modes are treating <em>experiments</em> like <em>systems</em>, or treating
                <em>systems</em> like <em>experiments</em>.
              </p>
            </div>
          </div>
        </div>
      </section>

      <!-- Right: Spectrum -->
      <section class="panel" aria-label="Spectrum">
        <div class="hd">
          <h2 id="rightTitle">Spectrum</h2>
        </div>
        <div class="bd">
          <!-- Rail view -->
          <div id="railView" class="spectrum">
            <div class="rail" aria-label="Consequence gradient">
              <div class="railhead">
                <span>Low consequence / disposable</span>
                <span>High consequence / durable</span>
              </div>

              <div class="cards" id="cards"></div>
            </div>

            <div class="detail" id="detail" aria-live="polite">
              <!-- populated by JS -->
            </div>

            <div class="footerhint">
              Tip: Use this to explain “vibe-coding” without the hype — it’s just choosing
              the right kind of code artefact for the job. Switch to <span class="kbd">2D map</span> to show axes.
            </div>
          </div>

          <!-- Plot view -->
          <div id="plotView" class="plotwrap" aria-label="2D map">
            <div class="plot">
              <div class="gridlines"></div>
              <div class="axes">
                <div class="ylabel">
                  <span>Low fidelity</span>
                  <span>High fidelity</span>
                </div>
                <div class="xlabel">
                  <span>Isolated</span>
                  <span>Integrated</span>
                </div>
              </div>
              <div id="nodes"></div>
            </div>

            <div class="detail" id="detail2" aria-live="polite"></div>
          </div>
        </div>
      </section>
    </div>
  </div>

  <script>
    // Data model:
    // integration & fidelity are used for 2D plot (0..100)
    // consequence, purpose are used for axis markers and labels (0..100)
    const LEVELS = [
      {
        id: "L1",
        name: "Cognitive artefacts (thinking tools)",
        intent: "Clarify thinking",
        consequence: 12,
        integration: 10,
        fidelity: 30,
        purpose: 25,
        riskLabel: "low",
        oneLiner: "Code as cognitive scaffolding: compress ambiguity, surface trade-offs, expose edge cases.",
        examples: [
          "PRDs + iterative refinement (artefact becomes the shared source of truth)",
          "UI explorations used to reason (not necessarily to ship)",
          "PolicyChat-style thinking tools",
          "Decision narratives / exec summaries (KV-style communication)"
        ],
        watchouts: [
          "Don’t over-engineer; optimise for learning, not longevity",
          "Be explicit: disposable artefact, not production commitment",
          "Capture key decisions so it doesn’t vanish into vibes"
        ],
        outputs: ["PRD", "concept UI", "interactive doc", "executable narrative"]
      },
      {
        id: "L2",
        name: "Experiential prototypes (clarity & fidelity)",
        intent: "Feel it",
        consequence: 35,
        integration: 20,
        fidelity: 75,
        purpose: 40,
        riskLabel: "mid",
        oneLiner: "Make the experience real when Figma can’t: motion, timing, state, and “how it feels.”",
        examples: [
          "Microinteraction + motion prototypes (hard to express in Figma)",
          "Voice/listening/speaking state simulations",
          "LLM chat UX flows with realistic latency & states",
          "High-fidelity demos for stakeholder alignment"
        ],
        watchouts: [
          "High fidelity can be persuasive — label what’s real vs mocked",
          "Avoid ‘demo debt’ (prototype becomes a promise)",
          "Document assumptions (latency, edge cases, content rules)"
        ],
        outputs: ["interactive prototype", "motion demo", "state model"]
      },
      {
        id: "L3",
        name: "Feasibility probes (engineering conversation tools)",
        intent: "Is this real?",
        consequence: 60,
        integration: 55,
        fidelity: 70,
        purpose: 55,
        riskLabel: "mid",
        oneLiner: "Stop debating feasibility in Slack: build a spike to learn the true shape of the problem.",
        examples: [
          "Transcript feature spike pulling from caption files",
          "API/data exploration: “what does the data actually look like?”",
          "QAing a branch on staging with targeted scripts/logging",
          "‘Should we take this to engineers?’ proof points"
        ],
        watchouts: [
          "Spikes need an explicit exit: what did we learn? what’s next?",
          "Don’t merge spike-quality code without hardening",
          "Align early with engineers on constraints + ownership"
        ],
        outputs: ["spike", "working proof", "tech notes", "risk/effort read"]
      },
      {
        id: "L4",
        name: "Integrated production extensions",
        intent: "Ship value",
        consequence: 82,
        integration: 85,
        fidelity: 92,
        purpose: 70,
        riskLabel: "high",
        oneLiner: "Cursor as a pair-programmer inside real constraints: maintainability, security, performance, ownership.",
        examples: [
          "Feature shipped from a Cursor-assisted build",
          "Working in the codebase with engineers refining/refactoring",
          "Production UI + logic implemented with review",
          "Telemetry / error handling / guardrails added"
        ],
        watchouts: [
          "Treat outputs as team code: style, tests, reviews, docs",
          "Watch for silent regressions + accessibility gaps",
          "No hero coding: clarify ownership and support paths"
        ],
        outputs: ["merged PR", "tested feature", "maintained component"]
      },
      {
        id: "L5",
        name: "Organisational leverage (systems, process, enablement)",
        intent: "Create leverage",
        consequence: 92,
        integration: 60,
        fidelity: 55,
        purpose: 92,
        riskLabel: "high",
        oneLiner: "The sleeper value: reduce friction and tribal knowledge with tools, docs, and automation.",
        examples: [
          "Documenting + archiving an email design system",
          "Template generators & guidelines for consistent outputs",
          "Release summaries / internal comms automation",
          "Internal tooling for repeatable workflows"
        ],
        watchouts: [
          "Avoid ‘tool sprawl’ — aim for adoption, not novelty",
          "Design governance: who maintains this?",
          "Make it discoverable: IA, naming, onboarding"
        ],
        outputs: ["docs", "generators", "automation", "shared systems"]
      }
    ];

    const $ = (sel, el=document) => el.querySelector(sel);

    const cardsEl = $("#cards");
    const detailEl = $("#detail");
    const detailEl2 = $("#detail2");
    const nodesEl = $("#nodes");

    const markers = {
      purpose: $("#mPurpose"),
      integration: $("#mIntegration"),
      fidelity: $("#mFidelity"),
      consequence: $("#mConsequence")
    };

    let selectedIndex = 0;

    function tagForRisk(riskLabel){
      if (riskLabel === "low") return { cls:"low", label:"Low consequence" };
      if (riskLabel === "high") return { cls:"high", label:"High consequence" };
      return { cls:"mid", label:"Medium consequence" };
    }

    function renderCards(){
      cardsEl.innerHTML = "";
      LEVELS.forEach((lvl, i) => {
        const risk = tagForRisk(lvl.riskLabel);
        const card = document.createElement("div");
        card.className = "card";
        card.setAttribute("role", "button");
        card.setAttribute("tabindex", "0");
        card.dataset.index = i;
        card.setAttribute("aria-selected", i === selectedIndex ? "true" : "false");
        card.innerHTML = `
          <div class="lvl">
            <span class="tag ${risk.cls}">
              <span class="dot"></span>
              ${lvl.id}
            </span>
            <span class="tag ${risk.cls}" title="Consequence level">
              <span class="dot"></span>
              ${risk.label}
            </span>
          </div>
          <h3>${lvl.name}</h3>
          <p>${lvl.oneLiner}</p>
          <div class="chips">
            ${lvl.outputs.slice(0,4).map(x => `<span class="chip">${x}</span>`).join("")}
          </div>
        `;
        card.addEventListener("click", () => select(i));
        card.addEventListener("keydown", (e) => {
          if(e.key === "Enter" || e.key === " ") { e.preventDefault(); select(i); }
        });
        cardsEl.appendChild(card);
      });
    }

    function renderDetail(targetEl, lvl){
      const risk = tagForRisk(lvl.riskLabel);

      targetEl.innerHTML = `
        <div class="top">
          <div>
            <h3>${lvl.id} — ${lvl.intent}</h3>
            <div class="detail-oneliner">${lvl.oneLiner}</div>
          </div>
          <div class="meta">
            <span class="pill2">purpose:${lvl.purpose}</span>
            <span class="pill2">integration:${lvl.integration}</span>
            <span class="pill2">fidelity:${lvl.fidelity}</span>
            <span class="pill2">consequence:${lvl.consequence}</span>
          </div>
        </div>

        <div class="cols">
          <div class="box">
            <b>Examples</b>
            <ul class="list">
              ${lvl.examples.map(x => `<li>${x}</li>`).join("")}
            </ul>
          </div>
          <div class="box">
            <b>Watch-outs</b>
            <ul class="list">
              ${lvl.watchouts.map(x => `<li>${x}</li>`).join("")}
            </ul>
          </div>
        </div>

        <div class="detail-footer">
          <span class="tag ${risk.cls}" style="padding:6px 10px">
            <span class="dot"></span>${risk.label}
          </span>
          <span class="chip">Best output: ${lvl.outputs[0]}</span>
          <span class="chip">Theme: ${lvl.intent}</span>
        </div>
      `;
    }

    function updateAxisMarkers(lvl){
      markers.purpose.style.left = lvl.purpose + "%";
      markers.integration.style.left = lvl.integration + "%";
      markers.fidelity.style.left = lvl.fidelity + "%";
      markers.consequence.style.left = lvl.consequence + "%";
    }

    function select(i){
      selectedIndex = Math.max(0, Math.min(LEVELS.length-1, i));
      // Update card selected states
      [...cardsEl.children].forEach((c, idx) => c.setAttribute("aria-selected", idx === selectedIndex ? "true" : "false"));
      // Update details
      const lvl = LEVELS[selectedIndex];
      renderDetail(detailEl, lvl);
      renderDetail(detailEl2, lvl);
      updateAxisMarkers(lvl);
      // Update nodes selection
      [...nodesEl.querySelectorAll(".node")].forEach((n, idx) => n.classList.toggle("sel", idx === selectedIndex));
    }

    function renderPlotNodes(){
      nodesEl.innerHTML = "";
      // Plot uses integration (x) and fidelity (y)
      LEVELS.forEach((lvl, i) => {
        const n = document.createElement("div");
        n.className = "node";
        n.dataset.index = i;
        n.dataset.label = lvl.id;

        // Color by consequence (light-mode friendly)
        const c = lvl.consequence;
        let bg = "#2d6a4f";
        if (c > 70) bg = "#b91c1c";
        else if (c > 40) bg = "#9a6700";
        n.style.background = bg;

        // Position (padding accounted in CSS: plot has 14px, but nodes are absolute)
        // We'll map 0..100 to 14..(100%-14) with a bit of headroom for labels.
        const x = lvl.integration;
        const y = lvl.fidelity;
        n.style.left = `calc(${x}% )`;
        n.style.top  = `calc(${100 - y}% )`; // higher fidelity -> higher on plot

        n.addEventListener("click", () => select(i));
        nodesEl.appendChild(n);
      });
    }

    // View toggles
    const railView = $("#railView");
    const plotView = $("#plotView");
    const btnRail = $("#btnRail");
    const btnPlot = $("#btnPlot");
    const rightTitle = $("#rightTitle");

    function setView(view){
      const isRail = view === "rail";
      btnRail.setAttribute("aria-pressed", isRail ? "true" : "false");
      btnPlot.setAttribute("aria-pressed", !isRail ? "true" : "false");
      railView.style.display = isRail ? "flex" : "none";
      plotView.classList.toggle("active", !isRail);
      rightTitle.textContent = isRail ? "Spectrum" : "2D map (integration × fidelity)";
    }

    btnRail.addEventListener("click", () => setView("rail"));
    btnPlot.addEventListener("click", () => setView("plot"));

    // Keyboard navigation across levels
    window.addEventListener("keydown", (e) => {
      // ignore if typing in an input (none here, but future-proof)
      const t = e.target;
      if (t && (t.tagName === "INPUT" || t.tagName === "TEXTAREA")) return;

      if (e.key === "ArrowRight") { e.preventDefault(); select(selectedIndex + 1); }
      if (e.key === "ArrowLeft")  { e.preventDefault(); select(selectedIndex - 1); }
      if (e.key.toLowerCase() === "m") { // quick toggle view
        const railPressed = btnRail.getAttribute("aria-pressed") === "true";
        setView(railPressed ? "plot" : "rail");
      }
    });

    // Init
    renderCards();
    renderPlotNodes();
    select(0);
    setView("rail");
  </script>
</body>
</html>
